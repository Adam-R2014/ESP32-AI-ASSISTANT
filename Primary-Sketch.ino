/* ESP32 AI Chat Server Connects to your own Wi-Fi hotspot and hosts a web-based ChatGPT interface. Prints the ESP32 IP in Serial for easy access.
 */
#include <WiFi.h> #include <WiFiClientSecure.h> #include <WebServer.h> #include <HTTPClient.h> #include <ArduinoJson.h>  // ===== WIFI SETTINGS ===== const char* ssid = "ESP32_STEAM_FEST"; // <-- Change this const char* password = "STEAM_2026"; // <-- Change this // ===== OPENAI ===== const char* apiKey = "API KEY HERE"; const char* apiUrl = "https://api.openai.com/v1/responses"; WebServer server(80); WiFiClientSecure client; String chatContext = ""; // ======== HTML PAGE ======== String htmlPage() { return R"rawliteral( <!DOCTYPE html> <html> <head> <meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1'> <title>ESP32 ChatGPT</title> <style> body{margin:0;background:#0f0f0f;color:#eee;font-family:system-ui,Arial;height:100vh;display:flex;flex-direction:column;} #header{padding:10px;text-align:center;background:#101820;font-size:18px;font-weight:bold;color:#00ffff;} #chat{flex:1;overflow-y:auto;padding:10px;display:flex;flex-direction:column;} .msg{margin:6px 0;padding:12px 14px;border-radius:16px;max-width:85%;width:fit-content;word-wrap:break-word;font-size:16px;line-height:1.4;} .user{background:#1f8f3f;align-self:flex-end;border-bottom-right-radius:4px;} .ai{background:#1f4f8f;align-self:flex-start;border-bottom-left-radius:4px;} #input{display:flex;padding:10px;background:#181818;gap:8px;} #q{flex:1;padding:14px;border-radius:14px;border:none;background:#2a2a2a;color:#fff;font-size:16px;} button{padding:14px 18px;border:none;border-radius:14px;background:#00ffff;color:#000;font-size:16px;font-weight:bold;} button:active{transform:scale(0.96);} </style> </head> <body> <div id='header'>ESP32 AI Assistant</div> <div id='chat'></div> <div id='input'> <input id='q' placeholder='Ask something...'> <button onclick='send()'>Send</button> </div> <script> let chat=document.getElementById('chat'); function scroll(){chat.scrollTop=chat.scrollHeight;} function typeText(text, div){ let i=0; function t(){if(i<text.length){div.innerHTML+=text[i++];scroll();setTimeout(t,18);}} t(); } function send(){ let q=document.getElementById('q').value.trim(); if(!q) return; let u=document.createElement('div'); u.className='msg user'; u.innerHTML=q; chat.appendChild(u); let a=document.createElement('div'); a.className='msg ai'; chat.appendChild(a); scroll(); document.getElementById('q').value=''; fetch('/ask?q='+encodeURIComponent(q)).then(r=>r.text()).then(t=>typeText(t,a)); } </script> </body> </html> )rawliteral"; } // ======== OPENAI QUERY ======== String askOpenAI(String prompt) { HTTPClient http; http.begin(client, apiUrl); http.addHeader("Content-Type", "application/json"); http.addHeader("Authorization", "Bearer " + String(apiKey)); DynamicJsonDocument doc(8192); doc["model"] = "gpt-4.1-mini"; doc["max_output_tokens"] = 250; JsonArray input = doc.createNestedArray("input"); if(chatContext.length() > 0){ JsonObject systemMsg = input.createNestedObject(); systemMsg["role"] = "system"; systemMsg["content"] = chatContext; } JsonObject userMsg = input.createNestedObject(); userMsg["role"] = "user"; userMsg["content"] = prompt; String payload; serializeJson(doc, payload); int httpCode = http.POST(payload); String response = ""; if(httpCode == 200){ response = http.getString(); } else { response = "Error: " + String(httpCode); } http.end(); DynamicJsonDocument res(8192); deserializeJson(res, response); String reply = ""; if(res.containsKey("output") && res["output"].size() > 0){ if(res["output"][0]["content"].size() > 0){ reply = res["output"][0]["content"][0]["text"].as<String>(); } } if(reply == "") reply = "Sorry, no response."; chatContext += "User: " + prompt + "\n"; chatContext += "Assistant: " + reply + "\n"; return reply; } // ======== ROUTES ======== void handleRoot() { server.send(200, "text/html", htmlPage()); } void handleAsk() { server.send(200, "text/plain", askOpenAI(server.arg("q"))); } // ======== SETUP ======== void setup() { Serial.begin(115200); // Connect to Wi-Fi WiFi.begin(ssid, password); Serial.print("Connecting to Wi-Fi"); while(WiFi.status() != WL_CONNECTED){ delay(500); Serial.print("."); } Serial.println(); Serial.println("Connected to Wi-Fi!"); Serial.print("ESP32 IP Address: "); Serial.println(WiFi.localIP()); // <- use this IP in browser or QR code client.setInsecure(); server.on("/", handleRoot); server.on("/ask", handleAsk); server.begin(); } // ======== LOOP ======== void loop() { server.handleClient(); }